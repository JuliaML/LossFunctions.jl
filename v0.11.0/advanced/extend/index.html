<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Altering existing Losses · LossFunctions.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://JuliaML.github.io/LossFunctions.jl/advanced/extend/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="LossFunctions.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LossFunctions.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/gettingstarted/">Getting Started</a></li><li><a class="tocitem" href="../../introduction/motivation/">Background and Motivation</a></li></ul></li><li><span class="tocitem">User&#39;s Guide</span><ul><li><a class="tocitem" href="../../user/interface/">Working with Losses</a></li><li><a class="tocitem" href="../../user/aggregate/">Efficient Sum and Mean</a></li></ul></li><li><span class="tocitem">Available Losses</span><ul><li><a class="tocitem" href="../../losses/distance/">Distance-based Losses</a></li><li><a class="tocitem" href="../../losses/margin/">Margin-based Losses</a></li><li><a class="tocitem" href="../../losses/other/">Other Losses</a></li></ul></li><li><span class="tocitem">Advances Topics</span><ul><li class="is-active"><a class="tocitem" href>Altering existing Losses</a><ul class="internal"><li><a class="tocitem" href="#Scaling-a-Supervised-Loss"><span>Scaling a Supervised Loss</span></a></li><li><a class="tocitem" href="#Reweighting-a-Margin-Loss"><span>Reweighting a Margin Loss</span></a></li></ul></li><li><a class="tocitem" href="../developer/">Developer Documentation</a></li></ul></li><li><a class="tocitem" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="tocitem" href="../../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advances Topics</a></li><li class="is-active"><a href>Altering existing Losses</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Altering existing Losses</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaML/LossFunctions.jl/blob/master/docs/src/advanced/extend.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Altering-existing-Losses"><a class="docs-heading-anchor" href="#Altering-existing-Losses">Altering existing Losses</a><a id="Altering-existing-Losses-1"></a><a class="docs-heading-anchor-permalink" href="#Altering-existing-Losses" title="Permalink"></a></h1><p>There are situations in which one wants to work with slightly altered versions of specific loss functions. This package provides two generic ways to create such meta losses for specific families of loss functions.</p><ol><li><p>Scaling a supervised loss by a constant real number. This is done at compile time and can in some situations even lead to simpler code (e.g. in the case of the derivative for a <a href="../../losses/distance/#LossFunctions.L2DistLoss"><code>L2DistLoss</code></a>)</p></li><li><p>Weighting the classes of a margin-based loss differently in order to better deal with unbalanced binary classification problems.</p></li></ol><h2 id="Scaling-a-Supervised-Loss"><a class="docs-heading-anchor" href="#Scaling-a-Supervised-Loss">Scaling a Supervised Loss</a><a id="Scaling-a-Supervised-Loss-1"></a><a class="docs-heading-anchor-permalink" href="#Scaling-a-Supervised-Loss" title="Permalink"></a></h2><p>It is quite common in machine learning courses to define the least squares loss as <span>$\frac{1}{2} (\hat{y} - y)^2$</span>, while this package implements that type of loss as an <span>$L_2$</span> distance loss using <span>$(\hat{y} - y)^2$</span>, i.e. without the constant scale factor.</p><p>For situations in which one wants a scaled version of an existing loss type, we provide the concept of a <strong>scaled loss</strong>. The difference is literally only a constant real number that gets multiplied to the existing implementation of the loss function (and derivatives).</p><article class="docstring"><header><a class="docstring-binding" id="LossFunctions.ScaledLoss" href="#LossFunctions.ScaledLoss"><code>LossFunctions.ScaledLoss</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ScaledLoss{L,K} &lt;: SupervisedLoss</code></pre><p>Can be used to represent a <code>K</code> times scaled version of a given type of loss <code>L</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaML/LossFunctions.jl/blob/67e5cbff9198355c4019e49e71804d3d7ac75363/src/losses/scaled.jl#L5-L10">source</a></section></article><pre><code class="language-julia-repl hljs">julia&gt; lsloss = 1/2 * L2DistLoss()
ScaledLoss{L2DistLoss, 0.5}(L2DistLoss())

julia&gt; L2DistLoss()(4.0, 0.0)
16.0

julia&gt; lsloss(4.0, 0.0)
8.0</code></pre><p>As you have probably noticed, the constant scale factor gets promoted to a type-parameter. This can be quite an overhead when done on the fly every time the loss value is computed. To avoid this one can make use of <code>Val</code> to specify the scale factor in a type-stable manner.</p><pre><code class="language-julia-repl hljs">julia&gt; sl = ScaledLoss(L2DistLoss(), Val(0.5))
ScaledLoss{L2DistLoss, 0.5}(L2DistLoss())</code></pre><p>Storing the scale factor as a type-parameter instead of a member variable has some nice advantages. It allows the compiler to do some quite convenient optimizations if possible. For example the compiler is able to figure out that the derivative simplifies for a scaled loss. This is accomplished using the power of <code>@fastmath</code>.</p><h2 id="Reweighting-a-Margin-Loss"><a class="docs-heading-anchor" href="#Reweighting-a-Margin-Loss">Reweighting a Margin Loss</a><a id="Reweighting-a-Margin-Loss-1"></a><a class="docs-heading-anchor-permalink" href="#Reweighting-a-Margin-Loss" title="Permalink"></a></h2><p>It is not uncommon in classification scenarios to find yourself working with in-balanced data sets, where one class has much more observations than the other one. There are different strategies to deal with this kind of problem. The approach that this package provides is to weight the loss for the classes differently. This basically means that we penalize mistakes in one class more than mistakes in the other class. More specifically we scale the loss of the positive class by the weight-factor <span>$w$</span> and the loss of the negative class with <span>$1-w$</span>.</p><pre><code class="language-julia-repl hljs">if target &gt; 0
    w * loss(target, output)
else
    (1-w) * loss(target, output)
end</code></pre><p>Instead of providing special functions to compute a class-weighted loss, we instead expose a generic way to create new weighted versions of already existing unweighted margin losses. This way, every existing subtype of <a href="advanced/@ref"><code>MarginLoss</code></a> can be re-weighted arbitrarily. Furthermore, it allows every algorithm that expects a binary loss to work with weighted binary losses as well.</p><article class="docstring"><header><a class="docstring-binding" id="LossFunctions.WeightedMarginLoss" href="#LossFunctions.WeightedMarginLoss"><code>LossFunctions.WeightedMarginLoss</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">WeightedMarginLoss{L,W} &lt;: MarginLoss</code></pre><p>Can an be used to represent a re-weighted version of some type of binary loss <code>L</code>. The weight-factor <code>W</code>, which must be in <code>[0, 1]</code>, denotes the relative weight of the positive class, while the relative weight of the negative class will be <code>1 - W</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaML/LossFunctions.jl/blob/67e5cbff9198355c4019e49e71804d3d7ac75363/src/losses/weighted.jl#L5-L12">source</a></section></article><pre><code class="language-julia-repl hljs">julia&gt; myloss = WeightedMarginLoss(HingeLoss(), 0.8)
WeightedMarginLoss{L1HingeLoss, 0.8}(L1HingeLoss())

julia&gt; myloss(-4.0, 1.0) # positive class
4.0

julia&gt; HingeLoss()(-4.0, 1.0)
5.0

julia&gt; myloss(4.0, -1.0) # negative class
0.9999999999999998

julia&gt; HingeLoss()(4.0, -1.0)
5.0</code></pre><p>Note that the scaled version of a margin-based loss does not anymore belong to the family of margin-based losses itself. In other words the resulting loss is neither a subtype of <a href="advanced/@ref"><code>MarginLoss</code></a>, nor of the original type of loss.</p><pre><code class="language-julia-repl hljs">julia&gt; typeof(myloss) &lt;: MarginLoss
false

julia&gt; typeof(myloss) &lt;: HingeLoss
false</code></pre><p>Similar to scaled losses, the constant weight factor gets promoted to a type-parameter. This can be quite an overhead when done on the fly every time the loss value is computed. To avoid this one can make use of <code>Val</code> to specify the scale factor in a type-stable manner.</p><pre><code class="language-julia-repl hljs">julia&gt; WeightedMarginLoss(HingeLoss(), Val(0.8))
WeightedMarginLoss{L1HingeLoss, 0.8}(L1HingeLoss())</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../losses/other/">« Other Losses</a><a class="docs-footer-nextpage" href="../developer/">Developer Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 30 July 2023 00:08">Sunday 30 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
