<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Efficient Sum and Mean · LossFunctions.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://JuliaML.github.io/LossFunctions.jl/user/aggregate/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="LossFunctions.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LossFunctions.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/gettingstarted/">Getting Started</a></li><li><a class="tocitem" href="../../introduction/motivation/">Background and Motivation</a></li></ul></li><li><span class="tocitem">User&#39;s Guide</span><ul><li><a class="tocitem" href="../interface/">Working with Losses</a></li><li class="is-active"><a class="tocitem" href>Efficient Sum and Mean</a></li></ul></li><li><span class="tocitem">Available Losses</span><ul><li><a class="tocitem" href="../../losses/distance/">Distance-based Losses</a></li><li><a class="tocitem" href="../../losses/margin/">Margin-based Losses</a></li><li><a class="tocitem" href="../../losses/other/">Other Losses</a></li></ul></li><li><span class="tocitem">Advances Topics</span><ul><li><a class="tocitem" href="../../advanced/extend/">Altering existing Losses</a></li><li><a class="tocitem" href="../../advanced/developer/">Developer Documentation</a></li></ul></li><li><a class="tocitem" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="tocitem" href="../../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User&#39;s Guide</a></li><li class="is-active"><a href>Efficient Sum and Mean</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Efficient Sum and Mean</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaML/LossFunctions.jl/blob/master/docs/src/user/aggregate.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Efficient-Sum-and-Mean"><a class="docs-heading-anchor" href="#Efficient-Sum-and-Mean">Efficient Sum and Mean</a><a id="Efficient-Sum-and-Mean-1"></a><a class="docs-heading-anchor-permalink" href="#Efficient-Sum-and-Mean" title="Permalink"></a></h1><p>In many situations we are not really that interested in the individual loss values (or derivatives) of each observation, but the sum or mean of them; be it weighted or unweighted. For example, by computing the unweighted mean of the loss for our training set, we would effectively compute what is known as the empirical risk. This is usually the quantity (or an important part of it) that we are interesting in minimizing.</p><p>When we say &quot;weighted&quot; or &quot;unweighted&quot;, we are referring to whether we are explicitly specifying the influence of individual observations on the result. &quot;Weighing&quot; an observation is achieved by multiplying its value with some number (i.e. the &quot;weight&quot; of that observation). As a consequence that weighted observation will have a stronger or weaker influence on the result. In order to weigh an observation we have to know which array dimension (if there are more than one) denotes the observations. On the other hand, for computing an unweighted result we don&#39;t actually need to know anything about the meaning of the array dimensions, as long as the <code>targets</code> and the <code>outputs</code> are of compatible shape and size.</p><p>The naive way to compute such an unweighted reduction, would be to call <code>mean</code> or <code>sum</code> on the result of the element-wise operation. The following code snipped show an example of that. We say &quot;naive&quot;, because it will not give us an acceptable performance.</p><pre><code class="language-julia-repl hljs">julia&gt; loss = L1DistLoss()
L1DistLoss()

julia&gt; loss.([2,5,-2], [1.,2,3])
3-element Vector{Float64}:
 1.0
 3.0
 5.0

julia&gt; sum(loss.([2,5,-2], [1.,2,3])) # WARNING: Bad code
9.0</code></pre><p>This works as expected, but there is a price for it. Before the sum can be computed, the solution will allocate a temporary array and fill it with the element-wise results. After that, <code>sum</code> will iterate over this temporary array and accumulate the values accordingly. Bottom line: we allocate temporary memory that we don&#39;t need in the end and could avoid.</p><p>For that reason we provide special methods that compute the common accumulations efficiently without allocating temporary arrays.</p><pre><code class="language-julia-repl hljs">julia&gt; sum(L1DistLoss(), [2,5,-2], [1.,2,3])
9.0

julia&gt; mean(L1DistLoss(), [2,5,-2], [1.,2,3])
3.0</code></pre><p>Up to this point, all the averaging was performed in an unweighted manner. That means that each observation was treated as equal and had thus the same potential influence on the result. In the following we will consider situations in which we do want to explicitly specify the influence of each observation (i.e. we want to weigh them). When we say we &quot;weigh&quot; an observation, what it effectively boils down to is multiplying the result for that observation (i.e. the computed loss) with some number. This is done for every observation individually.</p><p>To get a better understand of what we are talking about, let us consider performing a weighting scheme manually. The following code will compute the loss for three observations, and then multiply the result of the second observation with the number <code>2</code>, while the other two remains as they are. If we then sum up the results, we will see that the loss of the second observation was effectively counted twice.</p><pre><code class="language-julia-repl hljs">julia&gt; result = L1DistLoss().([2,5,-2], [1.,2,3]) .* [1,2,1]
3-element Vector{Float64}:
 1.0
 6.0
 5.0

julia&gt; sum(result)
12.0</code></pre><p>The point of weighing observations is to inform the learning algorithm we are working with, that it is more important to us to predict some observations correctly than it is for others. So really, the concrete weight-factor matters less than the ratio between the different weights. In the example above the second observation was thus considered twice as important as any of the other two observations.</p><pre><code class="language-julia-repl hljs">julia&gt; sum(L1DistLoss(), [2,5,-2], [1.,2,3], [1,2,1], normalize=false)
12.0

julia&gt; mean(L1DistLoss(), [2,5,-2], [1.,2,3], [1,2,1])
1.0</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../interface/">« Working with Losses</a><a class="docs-footer-nextpage" href="../../losses/distance/">Distance-based Losses »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 3 May 2023 17:20">Wednesday 3 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
